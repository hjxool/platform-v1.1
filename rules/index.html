<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" href="../module/element-ui.css">
  <link rel="stylesheet" href="../module/common_style.css">
  <link rel="stylesheet" href="./index.css">
</head>

<body>
  <div id="index" v-cloak v-loading="html.loading">
    <div class="header" style="justify-content: space-between;">
      <el-button type="primary" round @click="add_rules">新增规则</el-button>
      <el-button type="danger" icon="el-icon-close" circle @click="close_page(html.rule_config)"></el-button>
    </div>
    <!-- 规则表格 -->
    <div style="padding:0 10px;overflow: auto;">
      <el-table :data="rule_list" border>
        <el-table-column prop="name" label="规则名称"></el-table-column>
        <el-table-column prop="scenes" label="订阅场景"></el-table-column>
        <el-table-column prop="createAt" label="创建时间"></el-table-column>
        <el-table-column prop="updateAt" label="修改时间"></el-table-column>
        <el-table-column label="操作" width="150" fixed="right">
          <template slot-scope="scope">
            <el-button @click="edit_rule(scope.row)" type="text" size="small">编辑</el-button>
            <el-button @click="check_rule(scope.row.id)" type="text" size="small">查看</el-button>
          </template>
        </el-table-column>
      </el-table>
    </div>
    <!-- 触发条件及响应事件表格 -->
    <div class="custom_center" v-if="html.rule_config">
      <el-card style="width: 90%;height: 90%;overflow: auto;" shadow="hover">
        <div class="rule_detail_layout">
          <div class="header">
            <el-button type="primary" round @click="add_trigger">新增触发条件</el-button>
            <el-button type="primary" round>新增响应事件</el-button>
          </div>
          <div style="padding:0 10px;overflow: auto;">
            <el-table :data="trigger_and_event_list" border v-loading="html.loading_rule_detail">
              <el-table-column prop="type" label="配置类型"></el-table-column>
              <el-table-column prop="nodeName" label="配置名称"></el-table-column>
              <el-table-column label="操作" width="150" fixed="right">
                <template slot-scope="scope">
                  <el-button @click="edit_trigger_event(scope.row)" type="text" size="small">编辑</el-button>
                  <el-button @click="del_trigger_event(scope.row)" type="text" size="small">删除</el-button>
                </template>
              </el-table-column>
            </el-table>
          </div>
        </div>
      </el-card>
    </div>
    <!-- 新增/编辑规则 -->
    <div class="custom_center" v-if="html.trigger_config">
      <el-card style="width: 900px;max-height: 90%;overflow: auto;" shadow="hover">
        <div class="trigger_layout">
          <!-- 表单 -->
          <div class="rule_layout">
            <span class="title">编辑触发条件</span>
            <el-form label-width="100px" style="padding-right: 20px;">
              <el-form-item label="名称" size="medium">
                <el-input class="form_input" v-model="form.name" placeholder="请输入名称">
                </el-input>
              </el-form-item>
              <el-form-item label="条件表达式" size="medium">
                <el-input type="textarea" autosize v-model="form.exp" @input="throttle(identify_symbol,1500,form.exp)"
                  placeholder="请输入表达式">
                </el-input>
              </el-form-item>
              <el-form-item label="条件字段" size="medium">
                <el-input class="form_input" v-for="item in form.condition" v-model="item.field" placeholder="请输入字段名称">
                </el-input>
              </el-form-item>
              <el-form-item label="默认值" size="medium">
                <el-input class="form_input" v-for="item in form.condition" v-model="item.default_value"
                  placeholder="请设置默认值">
                </el-input>
              </el-form-item>
              <el-form-item class="button_layout">
                <el-button type="primary" @click="trigger_submit">保存</el-button>
                <el-button @click="del_form">取消</el-button>
              </el-form-item>
            </el-form>
          </div>
          <!-- JSON文本 -->
          <div class="rule_layout">
            <span class="title">物模型属性列表</span>
            <el-input class="form_input" type="textarea" autosize v-model="json_text"></el-input>
          </div>
        </div>
      </el-card>
    </div>
  </div>

  <script src="../../运维人员部署请修改我.js"></script>
  <script src="../module/vue.js"></script>
  <script src="../module/element-ui.js"></script>
  <script src="../module/axios.min.js"></script>
  <script src="../module/common_function.js"></script>
  <script src="./index.js"></script>
</body>

</html>